{
  "zero_patches": {
    "Location 1 (/root/hy/projects/django/django/db/models/constraints.py lines 19-47)": "\nclass BaseConstraint:\n    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n    violation_error_message = None\n    violation_error_code = None\n\n    # RemovedInDjango60Warning: When the deprecation ends, replace with:\n    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n        # RemovedInDjango60Warning.\n        if name is None and not args:\n            raise TypeError(\n                f\"{self.__class__.__name__}.__init__() missing 1 required keyword-only \"\n                f\"argument: 'name'\"\n            )\n        self.name = name\n        if violation_error_message is not None:\n            self.violation_error_message = violation_error_message\n        else:\n            self.violation_error_message = self.default_violation_error_message\n        if violation_error_code is not None:\n            self.violation_error_code = violation_error_code\n        # RemovedInDjango60Warning.\n        if args:\n            warnings.warn(\n                f\"Passing positional arguments to {self.__class__.__name__} is \"\n                f\"deprecated.\",\n                RemovedInDjango60Warning,\n                stacklevel=2,\n            )\n            for arg, attr in zip(args, [\"name\", \"violation_error_message\"]):\n                if arg:\n                    setattr(self, attr, arg)\n",
    "Location 2 (/root/hy/projects/django/django/db/models/constraints.py lines 65-66)": "\n    def get_violation_error_message(self):\n        return self.violation_error_message % {\"name\": self.name}\n\n    def get_violation_error(self):\n        message = self.get_violation_error_message()\n        if self.violation_error_code is not None:\n            return ValidationError(message, code=self.violation_error_code)\n        return ValidationError(message)\n",
    "Location 3 (/root/hy/projects/django/django/db/models/constraints.py lines 68-77)": "\n    def deconstruct(self):\n        path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n        path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n        kwargs = {\"name\": self.name}\n        if (\n            self.violation_error_message is not None\n            and self.violation_error_message != self.default_violation_error_message\n        ):\n            kwargs[\"violation_error_message\"] = self.violation_error_message\n        if self.violation_error_code is not None:\n            kwargs[\"violation_error_code\"] = self.violation_error_code\n        return (path, (), kwargs)\n",
    "Location 4 (/root/hy/projects/django/django/db/models/constraints.py lines 111-117)": "\n    def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n        against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n        try:\n            if not Q(self.check).check(against, using=using):\n                raise self.get_violation_error()\n        except FieldError:\n            pass\n",
    "Location 5 (/root/hy/projects/django/django/db/models/constraints.py lines 388-403)": "\n        if not self.condition:\n            if queryset.exists():\n                if self.expressions:\n                    raise self.get_violation_error()\n                # When fields are defined, use the unique_error_message() for\n                # backward compatibility.\n                for model, constraints in instance.get_constraints():\n                    for constraint in constraints:\n                        if constraint is self:\n                            raise ValidationError(\n                                instance.unique_error_message(model, self.fields)\n                            )\n        else:\n            against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n            try:\n                if (self.condition & Exists(queryset.filter(self.condition))).check(\n                    against, using=using\n                ):\n                    raise self.get_violation_error()\n"
  },
  "variant_patches": {
    "Location 1 (/root/hy/projects/django/django/db/models/constraints.py lines 19-47)": [
      "\nclass BaseConstraint:\n    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n    violation_error_message = None\n    violation_error_code = None\n\n    # RemovedInDjango60Warning: When the deprecation ends, replace with:\n    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n        # RemovedInDjango60Warning.\n        if name is None and not args:\n            raise TypeError(\n                f\"{self.__class__.__name__}.__init__() missing 1 required keyword-only \"\n                f\"argument: 'name'\"\n            )\n        self.name = name\n        if violation_error_message is not None:\n            self.violation_error_message = violation_error_message\n        else:\n            self.violation_error_message = self.default_violation_error_message\n        if violation_error_code is not None:\n            self.violation_error_code = violation_error_code\n        # RemovedInDjango60Warning.\n        if args:\n            warnings.warn(\n                f\"Passing positional arguments to {self.__class__.__name__} is \"\n                f\"deprecated.\",\n                RemovedInDjango60Warning,\n                stacklevel=2,\n            )\n            for arg, attr in zip(args, [\"name\", \"violation_error_message\"]):\n                if arg:\n                    setattr(self, attr, arg)\n",
      "\nclass BaseConstraint:\n    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n    violation_error_message = None\n    violation_error_code = None\n\n    # RemovedInDjango60Warning: When the deprecation ends, replace with:\n    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n        # RemovedInDjango60Warning.\n        if name is None and not args:\n            raise TypeError(\n                f\"{self.__class__.__name__}.__init__() missing 1 required keyword-only \"\n                f\"argument: 'name'\"\n            )\n        self.name = name\n        if violation_error_message is not None:\n            self.violation_error_message = violation_error_message\n        else:\n            self.violation_error_message = self.default_violation_error_message\n        if violation_error_code is not None:\n            self.violation_error_code = violation_error_code\n        # RemovedInDjango60Warning.\n        if args:\n            warnings.warn(\n                f\"Passing positional arguments to {self.__class__.__name__} is \"\n                f\"deprecated.\",\n                RemovedInDjango60Warning,\n                stacklevel=2,\n            )\n            for arg, attr in zip(args, [\"name\", \"violation_error_message\"]):\n                if arg:\n                    setattr(self, attr, arg)\n",
      "\nclass BaseConstraint:\n    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n    violation_error_message = None\n    violation_error_code = None\n\n    # RemovedInDjango60Warning: When the deprecation ends, replace with:\n    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n        # RemovedInDjango60Warning.\n        if name is None and not args:\n            raise TypeError(\n                f\"{self.__class__.__name__}.__init__() missing 1 required keyword-only \"\n                f\"argument: 'name'\"\n            )\n        self.name = name\n        if violation_error_message is not None:\n            self.violation_error_message = violation_error_message\n        else:\n            self.violation_error_message = self.default_violation_error_message\n        if violation_error_code is not None:\n            self.violation_error_code = violation_error_code\n        # RemovedInDjango60Warning.\n        if args:\n            warnings.warn(\n                f\"Passing positional arguments to {self.__class__.__name__} is \"\n                f\"deprecated.\",\n                RemovedInDjango60Warning,\n                stacklevel=2,\n            )\n            for arg, attr in zip(args, [\"name\", \"violation_error_message\"]):\n                if arg:\n                    setattr(self, attr, arg)\n",
      "\nclass BaseConstraint:\n    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n    violation_error_message = None\n    violation_error_code = None\n\n    # RemovedInDjango60Warning: When the deprecation ends, replace with:\n    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n        # RemovedInDjango60Warning.\n        if name is None and not args:\n            raise TypeError(\n                f\"{self.__class__.__name__}.__init__() missing 1 required keyword-only \"\n                f\"argument: 'name'\"\n            )\n        self.name = name\n        if violation_error_message is not None:\n            self.violation_error_message = violation_error_message\n        else:\n            self.violation_error_message = self.default_violation_error_message\n        if violation_error_code is not None:\n            self.violation_error_code = violation_error_code\n        # RemovedInDjango60Warning.\n        if args:\n            warnings.warn(\n                f\"Passing positional arguments to {self.__class__.__name__} is \"\n                f\"deprecated.\",\n                RemovedInDjango60Warning,\n                stacklevel=2,\n            )\n            for arg, attr in zip(args, [\"name\", \"violation_error_message\"]):\n                if arg:\n                    setattr(self, attr, arg)\n",
      "\nclass BaseConstraint:\n    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n    violation_error_message = None\n\n    # RemovedInDjango60Warning: When the deprecation ends, replace with:\n    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n        # RemovedInDjango60Warning.\n        if name is None and not args:\n            raise TypeError(\n                f\"{self.__class__.__name__}.__init__() missing 1 required keyword-only \"\n                f\"argument: 'name'\"\n            )\n        self.name = name\n        if violation_error_message is not None:\n            self.violation_error_message = violation_error_message\n        else:\n            self.violation_error_message = self.default_violation_error_message\n        self.violation_error_code = violation_error_code\n        # RemovedInDjango60Warning.\n        if args:\n            warnings.warn(\n                f\"Passing positional arguments to {self.__class__.__name__} is \"\n                f\"deprecated.\",\n                RemovedInDjango60Warning,\n                stacklevel=2,\n            )\n            for arg, attr in zip(args, [\"name\", \"violation_error_message\"]):\n                if arg:\n                    setattr(self, attr, arg)\n",
      "\nclass BaseConstraint:\n    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n    violation_error_message = None\n    violation_error_code = None\n\n    # RemovedInDjango60Warning: When the deprecation ends, replace with:\n    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n        # RemovedInDjango60Warning.\n        if name is None and not args:\n            raise TypeError(\n                f\"{self.__class__.__name__}.__init__() missing 1 required keyword-only \"\n                f\"argument: 'name'\"\n            )\n        self.name = name\n        if violation_error_message is not None:\n            self.violation_error_message = violation_error_message\n        else:\n            self.violation_error_message = self.default_violation_error_message\n        if violation_error_code is not None:\n            self.violation_error_code = violation_error_code\n        # RemovedInDjango60Warning.\n        if args:\n            warnings.warn(\n                f\"Passing positional arguments to {self.__class__.__name__} is \"\n                f\"deprecated.\",\n                RemovedInDjango60Warning,\n                stacklevel=2,\n            )\n            for arg, attr in zip(args, [\"name\", \"violation_error_message\"]):\n                if arg:\n                    setattr(self, attr, arg)\n",
      "\nclass BaseConstraint:\n    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n    violation_error_message = None\n    violation_error_code = None\n\n    # RemovedInDjango60Warning: When the deprecation ends, replace with:\n    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n        # RemovedInDjango60Warning.\n        if name is None and not args:\n            raise TypeError(\n                f\"{self.__class__.__name__}.__init__() missing 1 required keyword-only \"\n                f\"argument: 'name'\"\n            )\n        self.name = name\n        if violation_error_message is not None:\n            self.violation_error_message = violation_error_message\n        else:\n            self.violation_error_message = self.default_violation_error_message\n        if violation_error_code is not None:\n            self.violation_error_code = violation_error_code\n        # RemovedInDjango60Warning.\n        if args:\n            warnings.warn(\n                f\"Passing positional arguments to {self.__class__.__name__} is \"\n                f\"deprecated.\",\n                RemovedInDjango60Warning,\n                stacklevel=2,\n            )\n            for arg, attr in zip(args, [\"name\", \"violation_error_message\"]):\n                if arg:\n                    setattr(self, attr, arg)\n",
      "\nclass BaseConstraint:\n    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n    violation_error_message = None\n    violation_error_code = None\n\n    # RemovedInDjango60Warning: When the deprecation ends, replace with:\n    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n        # RemovedInDjango60Warning.\n        if name is None and not args:\n            raise TypeError(\n                f\"{self.__class__.__name__}.__init__() missing 1 required keyword-only \"\n                f\"argument: 'name'\"\n            )\n        self.name = name\n        if violation_error_message is not None:\n            self.violation_error_message = violation_error_message\n        else:\n            self.violation_error_message = self.default_violation_error_message\n        if violation_error_code is not None:\n            self.violation_error_code = violation_error_code\n        # RemovedInDjango60Warning.\n        if args:\n            warnings.warn(\n                f\"Passing positional arguments to {self.__class__.__name__} is \"\n                f\"deprecated.\",\n                RemovedInDjango60Warning,\n                stacklevel=2,\n            )\n            for arg, attr in zip(args, [\"name\", \"violation_error_message\"]):\n                if arg:\n                    setattr(self, attr, arg)\n"
    ],
    "Location 2 (/root/hy/projects/django/django/db/models/constraints.py lines 65-66)": [
      "\n    def get_violation_error_message(self):\n        return self.violation_error_message % {\"name\": self.name}\n\n    def get_violation_error(self):\n        message = self.get_violation_error_message()\n        if self.violation_error_code is not None:\n            return ValidationError(message, code=self.violation_error_code)\n        return ValidationError(message)\n",
      "\n    def get_violation_error_message(self):\n        return self.violation_error_message % {\"name\": self.name}\n\n    def get_violation_error(self):\n        message = self.get_violation_error_message()\n        if self.violation_error_code is not None:\n            return ValidationError(message, code=self.violation_error_code)\n        return ValidationError(message)\n",
      "\n    def get_violation_error_message(self):\n        return self.violation_error_message % {\"name\": self.name}\n\n    def get_violation_error(self):\n        \"\"\"Return a ValidationError with the formatted message and optional custom code.\"\"\"\n        message = self.get_violation_error_message()\n        if self.violation_error_code is not None:\n            return ValidationError(message, code=self.violation_error_code)\n        return ValidationError(message)\n",
      "\n    def get_violation_error_message(self):\n        return self.violation_error_message % {\"name\": self.name}\n\n    def get_violation_error(self):\n        message = self.get_violation_error_message()\n        if self.violation_error_code is not None:\n            return ValidationError(message, code=self.violation_error_code)\n        return ValidationError(message)\n",
      "\n    def get_violation_error_message(self):\n        return self.violation_error_message % {\"name\": self.name}\n\n    def get_violation_error(self):\n        message = self.get_violation_error_message()\n        if self.violation_error_code is not None:\n            return ValidationError(message, code=self.violation_error_code)\n        return ValidationError(message)\n",
      "\n    def get_violation_error_message(self):\n        return self.violation_error_message % {\"name\": self.name}\n\n    def get_violation_error(self):\n        message = self.get_violation_error_message()\n        if self.violation_error_code is not None:\n            return ValidationError(message, code=self.violation_error_code)\n        return ValidationError(message)\n",
      "\n    def get_violation_error_message(self):\n        return self.violation_error_message % {\"name\": self.name}\n\n    def get_violation_error(self):\n        message = self.get_violation_error_message()\n        if self.violation_error_code is not None:\n            return ValidationError(message, code=self.violation_error_code)\n        return ValidationError(message)\n",
      "\n    def get_violation_error_message(self):\n        return self.violation_error_message % {\"name\": self.name}\n\n    def get_violation_error(self):\n        message = self.get_violation_error_message()\n        if self.violation_error_code is not None:\n            return ValidationError(message, code=self.violation_error_code)\n        return ValidationError(message)\n"
    ],
    "Location 3 (/root/hy/projects/django/django/db/models/constraints.py lines 68-77)": [
      "\n    def deconstruct(self):\n        path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n        path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n        kwargs = {\"name\": self.name}\n        if (\n            self.violation_error_message is not None\n            and self.violation_error_message != self.default_violation_error_message\n        ):\n            kwargs[\"violation_error_message\"] = self.violation_error_message\n        if self.violation_error_code is not None:\n            kwargs[\"violation_error_code\"] = self.violation_error_code\n        return (path, (), kwargs)\n",
      "\n    def deconstruct(self):\n        path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n        path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n        kwargs = {\"name\": self.name}\n        if (\n            self.violation_error_message is not None\n            and self.violation_error_message != self.default_violation_error_message\n        ):\n            kwargs[\"violation_error_message\"] = self.violation_error_message\n        if self.violation_error_code is not None:\n            kwargs[\"violation_error_code\"] = self.violation_error_code\n        return (path, (), kwargs)\n",
      "\n    def deconstruct(self):\n        path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n        path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n        kwargs = {\"name\": self.name}\n        if (\n            self.violation_error_message is not None\n            and self.violation_error_message != self.default_violation_error_message\n        ):\n            kwargs[\"violation_error_message\"] = self.violation_error_message\n        if self.violation_error_code is not None:\n            kwargs[\"violation_error_code\"] = self.violation_error_code\n        return (path, (), kwargs)\n",
      "\n    def deconstruct(self):\n        path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n        path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n        kwargs = {\"name\": self.name}\n        if (\n            self.violation_error_message is not None\n            and self.violation_error_message != self.default_violation_error_message\n        ):\n            kwargs[\"violation_error_message\"] = self.violation_error_message\n        if self.violation_error_code is not None:\n            kwargs[\"violation_error_code\"] = self.violation_error_code\n        return (path, (), kwargs)\n",
      "\n    def deconstruct(self):\n        path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n        path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n        kwargs = {\"name\": self.name}\n        if (\n            self.violation_error_message is not None\n            and self.violation_error_message != self.default_violation_error_message\n        ):\n            kwargs[\"violation_error_message\"] = self.violation_error_message\n        if self.violation_error_code is not None:\n            kwargs[\"violation_error_code\"] = self.violation_error_code\n        return (path, (), kwargs)\n",
      "\n    def deconstruct(self):\n        path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n        path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n        kwargs = {\"name\": self.name}\n        if (\n            self.violation_error_message is not None\n            and self.violation_error_message != self.default_violation_error_message\n        ):\n            kwargs[\"violation_error_message\"] = self.violation_error_message\n        if self.violation_error_code is not None:\n            kwargs[\"violation_error_code\"] = self.violation_error_code\n        return (path, (), kwargs)\n",
      "\n    def deconstruct(self):\n        path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n        path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n        kwargs = {\"name\": self.name}\n        if (\n            self.violation_error_message is not None\n            and self.violation_error_message != self.default_violation_error_message\n        ):\n            kwargs[\"violation_error_message\"] = self.violation_error_message\n        if self.violation_error_code is not None:\n            kwargs[\"violation_error_code\"] = self.violation_error_code\n        return (path, (), kwargs)\n",
      "\n    def deconstruct(self):\n        path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n        path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n        kwargs = {\"name\": self.name}\n        if (\n            self.violation_error_message is not None\n            and self.violation_error_message != self.default_violation_error_message\n        ):\n            kwargs[\"violation_error_message\"] = self.violation_error_message\n        if self.violation_error_code is not None:\n            kwargs[\"violation_error_code\"] = self.violation_error_code\n        return (path, (), kwargs)\n"
    ],
    "Location 4 (/root/hy/projects/django/django/db/models/constraints.py lines 111-117)": [
      "\n    def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n        against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n        try:\n            if not Q(self.check).check(against, using=using):\n                raise self.get_violation_error()\n        except FieldError:\n            pass\n",
      "\n    def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n        against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n        try:\n            if not Q(self.check).check(against, using=using):\n                raise self.get_violation_error()\n        except FieldError:\n            pass\n",
      "\n    def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n        against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n        try:\n            if not Q(self.check).check(against, using=using):\n                raise self.get_violation_error()\n        except FieldError:\n            pass\n",
      "\n    def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n        against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n        try:\n            if not Q(self.check).check(against, using=using):\n                raise self.get_violation_error()\n        except FieldError:\n            pass\n",
      "\n    def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n        against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n        try:\n            if not Q(self.check).check(against, using=using):\n                raise self.get_violation_error()\n        except FieldError:\n            pass\n",
      "\n    def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n        against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n        try:\n            if not Q(self.check).check(against, using=using):\n                raise self.get_violation_error()\n        except FieldError:\n            pass\n",
      "\n    def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n        against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n        try:\n            if not Q(self.check).check(against, using=using):\n                raise self.get_violation_error()\n        except FieldError:\n            pass\n",
      "\n    def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n        against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n        try:\n            if not Q(self.check).check(against, using=using):\n                raise self.get_violation_error()\n        except FieldError:\n            pass\n"
    ],
    "Location 5 (/root/hy/projects/django/django/db/models/constraints.py lines 388-403)": [
      "\n        if not self.condition:\n            if queryset.exists():\n                if self.expressions:\n                    raise self.get_violation_error()\n                # When fields are defined, use the unique_error_message() for\n                # backward compatibility.\n                for model, constraints in instance.get_constraints():\n                    for constraint in constraints:\n                        if constraint is self:\n                            raise ValidationError(\n                                instance.unique_error_message(model, self.fields)\n                            )\n        else:\n            against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n            try:\n                if (self.condition & Exists(queryset.filter(self.condition))).check(\n                    against, using=using\n                ):\n                    raise self.get_violation_error()\n",
      "\n        if not self.condition:\n            if queryset.exists():\n                if self.expressions:\n                    raise self.get_violation_error()\n                # When fields are defined, use the unique_error_message() for\n                # backward compatibility.\n                for model, constraints in instance.get_constraints():\n                    for constraint in constraints:\n                        if constraint is self:\n                            raise ValidationError(\n                                instance.unique_error_message(model, self.fields)\n                            )\n        else:\n            against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n            try:\n                if (self.condition & Exists(queryset.filter(self.condition))).check(\n                    against, using=using\n                ):\n                    raise self.get_violation_error()\n",
      "\n        else:\n            against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n            try:\n                if (self.condition & Exists(queryset.filter(self.condition))).check(\n                    against, using=using\n                ):\n                    raise self.get_violation_error()\n            except FieldError:\n                pass\n",
      "\n        else:\n            against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n            try:\n                if (self.condition & Exists(queryset.filter(self.condition))).check(\n                    against, using=using\n                ):\n                    raise self.get_violation_error()\n            except FieldError:\n                pass\n",
      "\n        else:\n            against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n            try:\n                if (self.condition & Exists(queryset.filter(self.condition))).check(\n                    against, using=using\n                ):\n                    raise self.get_violation_error()\n            except FieldError:\n                pass\n",
      "\n        if not self.condition:\n            if queryset.exists():\n                if self.expressions:\n                    raise self.get_violation_error()\n                # When fields are defined, use the unique_error_message() for\n                # backward compatibility.\n                for model, constraints in instance.get_constraints():\n                    for constraint in constraints:\n                        if constraint is self:\n                            raise ValidationError(\n                                instance.unique_error_message(model, self.fields)\n                            )\n        else:\n            against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n            try:\n                if (self.condition & Exists(queryset.filter(self.condition))).check(\n                    against, using=using\n                ):\n                    raise self.get_violation_error()\n",
      "\n        else:\n            against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n            try:\n                if (self.condition & Exists(queryset.filter(self.condition))).check(\n                    against, using=using\n                ):\n                    raise self.get_violation_error()\n            except FieldError:\n                pass\n",
      "\n        else:\n            against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n            try:\n                if (self.condition & Exists(queryset.filter(self.condition))).check(\n                    against, using=using\n                ):\n                    raise self.get_violation_error()\n            except FieldError:\n                pass\n"
    ]
  },
  "combined_diffs": {
    "raw_patch": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee1be..6bee438f94 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -16,13 +16,15 @@ from django.utils.translation import gettext_lazy as _\n __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"]\n \n \n+\n class BaseConstraint:\n-    default_violation_error_message = _(\"Constraint “%(name)s” is violated.\")\n+    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n     violation_error_message = None\n+    violation_error_code = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +36,8 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        if violation_error_code is not None:\n+            self.violation_error_code = violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -62,9 +66,17 @@ class BaseConstraint:\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         raise NotImplementedError(\"This method must be implemented by a subclass.\")\n \n+\n     def get_violation_error_message(self):\n         return self.violation_error_message % {\"name\": self.name}\n \n+    def get_violation_error(self):\n+        return ValidationError(\n+            self.get_violation_error_message(),\n+            code=self.violation_error_code,\n+        )\n+\n+\n     def deconstruct(self):\n         path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n         path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n@@ -74,6 +86,8 @@ class BaseConstraint:\n             and self.violation_error_message != self.default_violation_error_message\n         ):\n             kwargs[\"violation_error_message\"] = self.violation_error_message\n+        if self.violation_error_code is not None:\n+            kwargs[\"violation_error_code\"] = self.violation_error_code\n         return (path, (), kwargs)\n \n     def clone(self):\n@@ -108,11 +122,12 @@ class CheckConstraint(BaseConstraint):\n     def remove_sql(self, model, schema_editor):\n         return schema_editor._delete_check_sql(model, self.name)\n \n+\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise self.get_violation_error()\n         except FieldError:\n             pass\n \n@@ -385,7 +400,8 @@ class UniqueConstraint(BaseConstraint):\n         if not self.condition:\n             if queryset.exists():\n                 if self.expressions:\n-                    raise ValidationError(self.get_violation_error_message())\n+\n+                    raise self.get_violation_error()\n                 # When fields are defined, use the unique_error_message() for\n                 # backward compatibility.\n                 for model, constraints in instance.get_constraints():\n@@ -400,6 +416,6 @@ class UniqueConstraint(BaseConstraint):\n                 if (self.condition & Exists(queryset.filter(self.condition))).check(\n                     against, using=using\n                 ):\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise self.get_violation_error()\n             except FieldError:\n                 pass\n",
    "variant_0": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee1be..1912a8d2e2 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -16,13 +16,15 @@ from django.utils.translation import gettext_lazy as _\n __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"]\n \n \n+\n class BaseConstraint:\n-    default_violation_error_message = _(\"Constraint “%(name)s” is violated.\")\n+    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n     violation_error_message = None\n+    violation_error_code = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +36,8 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        if violation_error_code is not None:\n+            self.violation_error_code = violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -62,9 +66,17 @@ class BaseConstraint:\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         raise NotImplementedError(\"This method must be implemented by a subclass.\")\n \n+\n     def get_violation_error_message(self):\n         return self.violation_error_message % {\"name\": self.name}\n \n+    def get_violation_error(self):\n+        message = self.get_violation_error_message()\n+        if self.violation_error_code is not None:\n+            return ValidationError(message, code=self.violation_error_code)\n+        return ValidationError(message)\n+\n+\n     def deconstruct(self):\n         path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n         path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n@@ -74,6 +86,8 @@ class BaseConstraint:\n             and self.violation_error_message != self.default_violation_error_message\n         ):\n             kwargs[\"violation_error_message\"] = self.violation_error_message\n+        if self.violation_error_code is not None:\n+            kwargs[\"violation_error_code\"] = self.violation_error_code\n         return (path, (), kwargs)\n \n     def clone(self):\n@@ -108,11 +122,12 @@ class CheckConstraint(BaseConstraint):\n     def remove_sql(self, model, schema_editor):\n         return schema_editor._delete_check_sql(model, self.name)\n \n+\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise self.get_violation_error()\n         except FieldError:\n             pass\n \n@@ -385,7 +400,11 @@ class UniqueConstraint(BaseConstraint):\n         if not self.condition:\n             if queryset.exists():\n                 if self.expressions:\n-                    raise ValidationError(self.get_violation_error_message())\n+\n+        if not self.condition:\n+            if queryset.exists():\n+                if self.expressions:\n+                    raise self.get_violation_error()\n                 # When fields are defined, use the unique_error_message() for\n                 # backward compatibility.\n                 for model, constraints in instance.get_constraints():\n@@ -400,6 +419,6 @@ class UniqueConstraint(BaseConstraint):\n                 if (self.condition & Exists(queryset.filter(self.condition))).check(\n                     against, using=using\n                 ):\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise self.get_violation_error()\n             except FieldError:\n                 pass\n",
    "variant_1": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee1be..1912a8d2e2 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -16,13 +16,15 @@ from django.utils.translation import gettext_lazy as _\n __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"]\n \n \n+\n class BaseConstraint:\n-    default_violation_error_message = _(\"Constraint “%(name)s” is violated.\")\n+    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n     violation_error_message = None\n+    violation_error_code = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +36,8 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        if violation_error_code is not None:\n+            self.violation_error_code = violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -62,9 +66,17 @@ class BaseConstraint:\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         raise NotImplementedError(\"This method must be implemented by a subclass.\")\n \n+\n     def get_violation_error_message(self):\n         return self.violation_error_message % {\"name\": self.name}\n \n+    def get_violation_error(self):\n+        message = self.get_violation_error_message()\n+        if self.violation_error_code is not None:\n+            return ValidationError(message, code=self.violation_error_code)\n+        return ValidationError(message)\n+\n+\n     def deconstruct(self):\n         path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n         path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n@@ -74,6 +86,8 @@ class BaseConstraint:\n             and self.violation_error_message != self.default_violation_error_message\n         ):\n             kwargs[\"violation_error_message\"] = self.violation_error_message\n+        if self.violation_error_code is not None:\n+            kwargs[\"violation_error_code\"] = self.violation_error_code\n         return (path, (), kwargs)\n \n     def clone(self):\n@@ -108,11 +122,12 @@ class CheckConstraint(BaseConstraint):\n     def remove_sql(self, model, schema_editor):\n         return schema_editor._delete_check_sql(model, self.name)\n \n+\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise self.get_violation_error()\n         except FieldError:\n             pass\n \n@@ -385,7 +400,11 @@ class UniqueConstraint(BaseConstraint):\n         if not self.condition:\n             if queryset.exists():\n                 if self.expressions:\n-                    raise ValidationError(self.get_violation_error_message())\n+\n+        if not self.condition:\n+            if queryset.exists():\n+                if self.expressions:\n+                    raise self.get_violation_error()\n                 # When fields are defined, use the unique_error_message() for\n                 # backward compatibility.\n                 for model, constraints in instance.get_constraints():\n@@ -400,6 +419,6 @@ class UniqueConstraint(BaseConstraint):\n                 if (self.condition & Exists(queryset.filter(self.condition))).check(\n                     against, using=using\n                 ):\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise self.get_violation_error()\n             except FieldError:\n                 pass\n",
    "variant_2": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee1be..1912a8d2e2 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -16,13 +16,15 @@ from django.utils.translation import gettext_lazy as _\n __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"]\n \n \n+\n class BaseConstraint:\n-    default_violation_error_message = _(\"Constraint “%(name)s” is violated.\")\n+    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n     violation_error_message = None\n+    violation_error_code = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +36,8 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        if violation_error_code is not None:\n+            self.violation_error_code = violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -62,9 +66,17 @@ class BaseConstraint:\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         raise NotImplementedError(\"This method must be implemented by a subclass.\")\n \n+\n     def get_violation_error_message(self):\n         return self.violation_error_message % {\"name\": self.name}\n \n+    def get_violation_error(self):\n+        message = self.get_violation_error_message()\n+        if self.violation_error_code is not None:\n+            return ValidationError(message, code=self.violation_error_code)\n+        return ValidationError(message)\n+\n+\n     def deconstruct(self):\n         path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n         path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n@@ -74,6 +86,8 @@ class BaseConstraint:\n             and self.violation_error_message != self.default_violation_error_message\n         ):\n             kwargs[\"violation_error_message\"] = self.violation_error_message\n+        if self.violation_error_code is not None:\n+            kwargs[\"violation_error_code\"] = self.violation_error_code\n         return (path, (), kwargs)\n \n     def clone(self):\n@@ -108,11 +122,12 @@ class CheckConstraint(BaseConstraint):\n     def remove_sql(self, model, schema_editor):\n         return schema_editor._delete_check_sql(model, self.name)\n \n+\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise self.get_violation_error()\n         except FieldError:\n             pass\n \n@@ -385,7 +400,11 @@ class UniqueConstraint(BaseConstraint):\n         if not self.condition:\n             if queryset.exists():\n                 if self.expressions:\n-                    raise ValidationError(self.get_violation_error_message())\n+\n+        if not self.condition:\n+            if queryset.exists():\n+                if self.expressions:\n+                    raise self.get_violation_error()\n                 # When fields are defined, use the unique_error_message() for\n                 # backward compatibility.\n                 for model, constraints in instance.get_constraints():\n@@ -400,6 +419,6 @@ class UniqueConstraint(BaseConstraint):\n                 if (self.condition & Exists(queryset.filter(self.condition))).check(\n                     against, using=using\n                 ):\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise self.get_violation_error()\n             except FieldError:\n                 pass\n",
    "variant_3": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee1be..4ad68cad4c 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -16,13 +16,15 @@ from django.utils.translation import gettext_lazy as _\n __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"]\n \n \n+\n class BaseConstraint:\n-    default_violation_error_message = _(\"Constraint “%(name)s” is violated.\")\n+    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n     violation_error_message = None\n+    violation_error_code = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +36,8 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        if violation_error_code is not None:\n+            self.violation_error_code = violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -62,9 +66,18 @@ class BaseConstraint:\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         raise NotImplementedError(\"This method must be implemented by a subclass.\")\n \n+\n     def get_violation_error_message(self):\n         return self.violation_error_message % {\"name\": self.name}\n \n+    def get_violation_error(self):\n+        \"\"\"Return a ValidationError with the formatted message and optional custom code.\"\"\"\n+        message = self.get_violation_error_message()\n+        if self.violation_error_code is not None:\n+            return ValidationError(message, code=self.violation_error_code)\n+        return ValidationError(message)\n+\n+\n     def deconstruct(self):\n         path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n         path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n@@ -74,6 +87,8 @@ class BaseConstraint:\n             and self.violation_error_message != self.default_violation_error_message\n         ):\n             kwargs[\"violation_error_message\"] = self.violation_error_message\n+        if self.violation_error_code is not None:\n+            kwargs[\"violation_error_code\"] = self.violation_error_code\n         return (path, (), kwargs)\n \n     def clone(self):\n@@ -108,11 +123,12 @@ class CheckConstraint(BaseConstraint):\n     def remove_sql(self, model, schema_editor):\n         return schema_editor._delete_check_sql(model, self.name)\n \n+\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise self.get_violation_error()\n         except FieldError:\n             pass\n \n@@ -385,21 +401,15 @@ class UniqueConstraint(BaseConstraint):\n         if not self.condition:\n             if queryset.exists():\n                 if self.expressions:\n-                    raise ValidationError(self.get_violation_error_message())\n-                # When fields are defined, use the unique_error_message() for\n-                # backward compatibility.\n-                for model, constraints in instance.get_constraints():\n-                    for constraint in constraints:\n-                        if constraint is self:\n-                            raise ValidationError(\n-                                instance.unique_error_message(model, self.fields)\n-                            )\n+\n         else:\n             against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n             try:\n                 if (self.condition & Exists(queryset.filter(self.condition))).check(\n                     against, using=using\n                 ):\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise self.get_violation_error()\n+            except FieldError:\n+                pass\n             except FieldError:\n                 pass\n",
    "variant_4": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee1be..4c50e6848d 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -16,13 +16,15 @@ from django.utils.translation import gettext_lazy as _\n __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"]\n \n \n+\n class BaseConstraint:\n-    default_violation_error_message = _(\"Constraint “%(name)s” is violated.\")\n+    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n     violation_error_message = None\n+    violation_error_code = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +36,8 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        if violation_error_code is not None:\n+            self.violation_error_code = violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -62,9 +66,17 @@ class BaseConstraint:\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         raise NotImplementedError(\"This method must be implemented by a subclass.\")\n \n+\n     def get_violation_error_message(self):\n         return self.violation_error_message % {\"name\": self.name}\n \n+    def get_violation_error(self):\n+        message = self.get_violation_error_message()\n+        if self.violation_error_code is not None:\n+            return ValidationError(message, code=self.violation_error_code)\n+        return ValidationError(message)\n+\n+\n     def deconstruct(self):\n         path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n         path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n@@ -74,6 +86,8 @@ class BaseConstraint:\n             and self.violation_error_message != self.default_violation_error_message\n         ):\n             kwargs[\"violation_error_message\"] = self.violation_error_message\n+        if self.violation_error_code is not None:\n+            kwargs[\"violation_error_code\"] = self.violation_error_code\n         return (path, (), kwargs)\n \n     def clone(self):\n@@ -108,11 +122,12 @@ class CheckConstraint(BaseConstraint):\n     def remove_sql(self, model, schema_editor):\n         return schema_editor._delete_check_sql(model, self.name)\n \n+\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise self.get_violation_error()\n         except FieldError:\n             pass\n \n@@ -385,21 +400,15 @@ class UniqueConstraint(BaseConstraint):\n         if not self.condition:\n             if queryset.exists():\n                 if self.expressions:\n-                    raise ValidationError(self.get_violation_error_message())\n-                # When fields are defined, use the unique_error_message() for\n-                # backward compatibility.\n-                for model, constraints in instance.get_constraints():\n-                    for constraint in constraints:\n-                        if constraint is self:\n-                            raise ValidationError(\n-                                instance.unique_error_message(model, self.fields)\n-                            )\n+\n         else:\n             against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n             try:\n                 if (self.condition & Exists(queryset.filter(self.condition))).check(\n                     against, using=using\n                 ):\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise self.get_violation_error()\n+            except FieldError:\n+                pass\n             except FieldError:\n                 pass\n",
    "variant_5": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee1be..9bcf6ac9c7 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -16,13 +16,14 @@ from django.utils.translation import gettext_lazy as _\n __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"]\n \n \n+\n class BaseConstraint:\n-    default_violation_error_message = _(\"Constraint “%(name)s” is violated.\")\n+    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n     violation_error_message = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +35,7 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        self.violation_error_code = violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -62,9 +64,17 @@ class BaseConstraint:\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         raise NotImplementedError(\"This method must be implemented by a subclass.\")\n \n+\n     def get_violation_error_message(self):\n         return self.violation_error_message % {\"name\": self.name}\n \n+    def get_violation_error(self):\n+        message = self.get_violation_error_message()\n+        if self.violation_error_code is not None:\n+            return ValidationError(message, code=self.violation_error_code)\n+        return ValidationError(message)\n+\n+\n     def deconstruct(self):\n         path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n         path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n@@ -74,6 +84,8 @@ class BaseConstraint:\n             and self.violation_error_message != self.default_violation_error_message\n         ):\n             kwargs[\"violation_error_message\"] = self.violation_error_message\n+        if self.violation_error_code is not None:\n+            kwargs[\"violation_error_code\"] = self.violation_error_code\n         return (path, (), kwargs)\n \n     def clone(self):\n@@ -108,11 +120,12 @@ class CheckConstraint(BaseConstraint):\n     def remove_sql(self, model, schema_editor):\n         return schema_editor._delete_check_sql(model, self.name)\n \n+\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise self.get_violation_error()\n         except FieldError:\n             pass\n \n@@ -385,21 +398,15 @@ class UniqueConstraint(BaseConstraint):\n         if not self.condition:\n             if queryset.exists():\n                 if self.expressions:\n-                    raise ValidationError(self.get_violation_error_message())\n-                # When fields are defined, use the unique_error_message() for\n-                # backward compatibility.\n-                for model, constraints in instance.get_constraints():\n-                    for constraint in constraints:\n-                        if constraint is self:\n-                            raise ValidationError(\n-                                instance.unique_error_message(model, self.fields)\n-                            )\n+\n         else:\n             against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n             try:\n                 if (self.condition & Exists(queryset.filter(self.condition))).check(\n                     against, using=using\n                 ):\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise self.get_violation_error()\n+            except FieldError:\n+                pass\n             except FieldError:\n                 pass\n",
    "variant_6": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee1be..1912a8d2e2 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -16,13 +16,15 @@ from django.utils.translation import gettext_lazy as _\n __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"]\n \n \n+\n class BaseConstraint:\n-    default_violation_error_message = _(\"Constraint “%(name)s” is violated.\")\n+    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n     violation_error_message = None\n+    violation_error_code = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +36,8 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        if violation_error_code is not None:\n+            self.violation_error_code = violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -62,9 +66,17 @@ class BaseConstraint:\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         raise NotImplementedError(\"This method must be implemented by a subclass.\")\n \n+\n     def get_violation_error_message(self):\n         return self.violation_error_message % {\"name\": self.name}\n \n+    def get_violation_error(self):\n+        message = self.get_violation_error_message()\n+        if self.violation_error_code is not None:\n+            return ValidationError(message, code=self.violation_error_code)\n+        return ValidationError(message)\n+\n+\n     def deconstruct(self):\n         path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n         path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n@@ -74,6 +86,8 @@ class BaseConstraint:\n             and self.violation_error_message != self.default_violation_error_message\n         ):\n             kwargs[\"violation_error_message\"] = self.violation_error_message\n+        if self.violation_error_code is not None:\n+            kwargs[\"violation_error_code\"] = self.violation_error_code\n         return (path, (), kwargs)\n \n     def clone(self):\n@@ -108,11 +122,12 @@ class CheckConstraint(BaseConstraint):\n     def remove_sql(self, model, schema_editor):\n         return schema_editor._delete_check_sql(model, self.name)\n \n+\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise self.get_violation_error()\n         except FieldError:\n             pass\n \n@@ -385,7 +400,11 @@ class UniqueConstraint(BaseConstraint):\n         if not self.condition:\n             if queryset.exists():\n                 if self.expressions:\n-                    raise ValidationError(self.get_violation_error_message())\n+\n+        if not self.condition:\n+            if queryset.exists():\n+                if self.expressions:\n+                    raise self.get_violation_error()\n                 # When fields are defined, use the unique_error_message() for\n                 # backward compatibility.\n                 for model, constraints in instance.get_constraints():\n@@ -400,6 +419,6 @@ class UniqueConstraint(BaseConstraint):\n                 if (self.condition & Exists(queryset.filter(self.condition))).check(\n                     against, using=using\n                 ):\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise self.get_violation_error()\n             except FieldError:\n                 pass\n",
    "variant_7": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee1be..4c50e6848d 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -16,13 +16,15 @@ from django.utils.translation import gettext_lazy as _\n __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"]\n \n \n+\n class BaseConstraint:\n-    default_violation_error_message = _(\"Constraint “%(name)s” is violated.\")\n+    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n     violation_error_message = None\n+    violation_error_code = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +36,8 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        if violation_error_code is not None:\n+            self.violation_error_code = violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -62,9 +66,17 @@ class BaseConstraint:\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         raise NotImplementedError(\"This method must be implemented by a subclass.\")\n \n+\n     def get_violation_error_message(self):\n         return self.violation_error_message % {\"name\": self.name}\n \n+    def get_violation_error(self):\n+        message = self.get_violation_error_message()\n+        if self.violation_error_code is not None:\n+            return ValidationError(message, code=self.violation_error_code)\n+        return ValidationError(message)\n+\n+\n     def deconstruct(self):\n         path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n         path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n@@ -74,6 +86,8 @@ class BaseConstraint:\n             and self.violation_error_message != self.default_violation_error_message\n         ):\n             kwargs[\"violation_error_message\"] = self.violation_error_message\n+        if self.violation_error_code is not None:\n+            kwargs[\"violation_error_code\"] = self.violation_error_code\n         return (path, (), kwargs)\n \n     def clone(self):\n@@ -108,11 +122,12 @@ class CheckConstraint(BaseConstraint):\n     def remove_sql(self, model, schema_editor):\n         return schema_editor._delete_check_sql(model, self.name)\n \n+\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise self.get_violation_error()\n         except FieldError:\n             pass\n \n@@ -385,21 +400,15 @@ class UniqueConstraint(BaseConstraint):\n         if not self.condition:\n             if queryset.exists():\n                 if self.expressions:\n-                    raise ValidationError(self.get_violation_error_message())\n-                # When fields are defined, use the unique_error_message() for\n-                # backward compatibility.\n-                for model, constraints in instance.get_constraints():\n-                    for constraint in constraints:\n-                        if constraint is self:\n-                            raise ValidationError(\n-                                instance.unique_error_message(model, self.fields)\n-                            )\n+\n         else:\n             against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n             try:\n                 if (self.condition & Exists(queryset.filter(self.condition))).check(\n                     against, using=using\n                 ):\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise self.get_violation_error()\n+            except FieldError:\n+                pass\n             except FieldError:\n                 pass\n",
    "variant_8": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee1be..4c50e6848d 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -16,13 +16,15 @@ from django.utils.translation import gettext_lazy as _\n __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"]\n \n \n+\n class BaseConstraint:\n-    default_violation_error_message = _(\"Constraint “%(name)s” is violated.\")\n+    default_violation_error_message = _(\"Constraint \"%(name)s\" is violated.\")\n     violation_error_message = None\n+    violation_error_code = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +36,8 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        if violation_error_code is not None:\n+            self.violation_error_code = violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -62,9 +66,17 @@ class BaseConstraint:\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         raise NotImplementedError(\"This method must be implemented by a subclass.\")\n \n+\n     def get_violation_error_message(self):\n         return self.violation_error_message % {\"name\": self.name}\n \n+    def get_violation_error(self):\n+        message = self.get_violation_error_message()\n+        if self.violation_error_code is not None:\n+            return ValidationError(message, code=self.violation_error_code)\n+        return ValidationError(message)\n+\n+\n     def deconstruct(self):\n         path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n         path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n@@ -74,6 +86,8 @@ class BaseConstraint:\n             and self.violation_error_message != self.default_violation_error_message\n         ):\n             kwargs[\"violation_error_message\"] = self.violation_error_message\n+        if self.violation_error_code is not None:\n+            kwargs[\"violation_error_code\"] = self.violation_error_code\n         return (path, (), kwargs)\n \n     def clone(self):\n@@ -108,11 +122,12 @@ class CheckConstraint(BaseConstraint):\n     def remove_sql(self, model, schema_editor):\n         return schema_editor._delete_check_sql(model, self.name)\n \n+\n     def validate(self, model, instance, exclude=None, using=DEFAULT_DB_ALIAS):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise self.get_violation_error()\n         except FieldError:\n             pass\n \n@@ -385,21 +400,15 @@ class UniqueConstraint(BaseConstraint):\n         if not self.condition:\n             if queryset.exists():\n                 if self.expressions:\n-                    raise ValidationError(self.get_violation_error_message())\n-                # When fields are defined, use the unique_error_message() for\n-                # backward compatibility.\n-                for model, constraints in instance.get_constraints():\n-                    for constraint in constraints:\n-                        if constraint is self:\n-                            raise ValidationError(\n-                                instance.unique_error_message(model, self.fields)\n-                            )\n+\n         else:\n             against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n             try:\n                 if (self.condition & Exists(queryset.filter(self.condition))).check(\n                     against, using=using\n                 ):\n-                    raise ValidationError(self.get_violation_error_message())\n+                    raise self.get_violation_error()\n+            except FieldError:\n+                pass\n             except FieldError:\n                 pass\n"
  }
}