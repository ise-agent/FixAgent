{
  "zero_patches": {
    "Location 1 (/root/hy/projects_4/matplotlib/lib/matplotlib/offsetbox.py lines 1511-1511)": "\n    # A property, not an attribute, to maintain picklability.\n    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n",
    "Location 2 (/root/hy/projects_4/matplotlib/lib/matplotlib/offsetbox.py lines 1559-1569)": "\ndef disconnect(self):\n    \"\"\"Disconnect the callbacks.\"\"\"\n    canvas = self.canvas  # Get canvas once to avoid multiple property calls\n    if canvas is not None:\n        for cid in self.cids:\n            canvas.mpl_disconnect(cid)\n        try:\n            c1 = self._c1\n        except AttributeError:\n            pass\n        else:\n            canvas.mpl_disconnect(c1)\n",
    "Location 3 (/root/hy/projects_4/matplotlib/lib/matplotlib/offsetbox.py lines 1549-1556)": "\n    def on_release(self, event):\n        if self._check_still_parented() and self.got_artist:\n            self.finalize_offset()\n            self.got_artist = False\n            self.canvas.mpl_disconnect(self._c1)\n\n            if self._use_blit:\n                self.ref_artist.set_animated(False)\n\n    def _check_still_parented(self):\n        if self.ref_artist.figure is None:\n            self.disconnect()\n            return False\n        else:\n            return True\n"
  },
  "variant_patches": {
    "Location 1 (/root/hy/projects_4/matplotlib/lib/matplotlib/offsetbox.py lines 1511-1511)": [
      "\n    # A property, not an attribute, to maintain picklability.\n    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n",
      "\n    # A property, not an attribute, to maintain picklability.\n    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n",
      "\n    # A property, not an attribute, to maintain picklability.\n    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n",
      "\n    # A property, not an attribute, to maintain picklability.\n    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n",
      "\n    # A property, not an attribute, to maintain picklability.\n    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n",
      "\n    # A property, not an attribute, to maintain picklability.\n    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n",
      "\n    # A property, not an attribute, to maintain picklability.\n    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n",
      "\n    # A property, not an attribute, to maintain picklability.\n    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n"
    ],
    "Location 2 (/root/hy/projects_4/matplotlib/lib/matplotlib/offsetbox.py lines 1559-1569)": [
      "\ndef disconnect(self):\n    \"\"\"Disconnect the callbacks.\"\"\"\n    canvas = self.canvas  # Get canvas once to avoid multiple property calls\n    if canvas is not None:\n        for cid in self.cids:\n            canvas.mpl_disconnect(cid)\n        try:\n            c1 = self._c1\n        except AttributeError:\n            pass\n        else:\n            canvas.mpl_disconnect(c1)\n",
      "\ndef disconnect(self):\n    \"\"\"Disconnect the callbacks.\"\"\"\n    canvas = self.canvas  # Get canvas once to avoid multiple property calls\n    if canvas is not None:\n        for cid in self.cids:\n            canvas.mpl_disconnect(cid)\n        try:\n            c1 = self._c1\n        except AttributeError:\n            pass\n        else:\n            canvas.mpl_disconnect(c1)\n",
      "\n    def disconnect(self):\n        \"\"\"Disconnect the callbacks.\"\"\"\n        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n        if canvas is not None:\n            for cid in self.cids:\n                canvas.mpl_disconnect(cid)\n            try:\n                c1 = self._c1\n            except AttributeError:\n                pass\n            else:\n                canvas.mpl_disconnect(c1)\n",
      "\n    def disconnect(self):\n        \"\"\"Disconnect the callbacks.\"\"\"\n        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n        if canvas is not None:\n            for cid in self.cids:\n                canvas.mpl_disconnect(cid)\n            try:\n                c1 = self._c1\n            except AttributeError:\n                pass\n            else:\n                canvas.mpl_disconnect(c1)\n",
      "\n    def disconnect(self):\n        \"\"\"Disconnect the callbacks.\"\"\"\n        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n        if canvas is not None:\n            for cid in self.cids:\n                canvas.mpl_disconnect(cid)\n            try:\n                c1 = self._c1\n            except AttributeError:\n                pass\n            else:\n                canvas.mpl_disconnect(c1)\n",
      "\n    def disconnect(self):\n        \"\"\"Disconnect the callbacks.\"\"\"\n        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n        if canvas is not None:\n            for cid in self.cids:\n                canvas.mpl_disconnect(cid)\n            try:\n                c1 = self._c1\n            except AttributeError:\n                pass\n            else:\n                canvas.mpl_disconnect(c1)\n",
      "\n    def disconnect(self):\n        \"\"\"Disconnect the callbacks.\"\"\"\n        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n        if canvas is not None:\n            for cid in self.cids:\n                canvas.mpl_disconnect(cid)\n            try:\n                c1 = self._c1\n            except AttributeError:\n                pass\n            else:\n                canvas.mpl_disconnect(c1)\n",
      "\n    def disconnect(self):\n        \"\"\"Disconnect the callbacks.\"\"\"\n        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n        if canvas is not None:\n            for cid in self.cids:\n                canvas.mpl_disconnect(cid)\n            try:\n                c1 = self._c1\n            except AttributeError:\n                pass\n            else:\n                canvas.mpl_disconnect(c1)\n"
    ],
    "Location 3 (/root/hy/projects_4/matplotlib/lib/matplotlib/offsetbox.py lines 1549-1556)": [
      "\n    def on_release(self, event):\n        if self._check_still_parented() and self.got_artist:\n            self.finalize_offset()\n            self.got_artist = False\n            self.canvas.mpl_disconnect(self._c1)\n\n            if self._use_blit:\n                self.ref_artist.set_animated(False)\n\n    def _check_still_parented(self):\n        if self.ref_artist.figure is None:\n            self.disconnect()\n            return False\n        else:\n            return True\n",
      "\n    def on_release(self, event):\n        if self._check_still_parented() and self.got_artist:\n            self.finalize_offset()\n            self.got_artist = False\n            self.canvas.mpl_disconnect(self._c1)\n\n            if self._use_blit:\n                self.ref_artist.set_animated(False)\n\n    def _check_still_parented(self):\n        if self.ref_artist.figure is None:\n            self.disconnect()\n            return False\n        else:\n            return True\n",
      "\n    def on_release(self, event):\n        if self._check_still_parented() and self.got_artist:\n            self.finalize_offset()\n            self.got_artist = False\n            self.canvas.mpl_disconnect(self._c1)\n\n            if self._use_blit:\n                self.ref_artist.set_animated(False)\n\n    def _check_still_parented(self):\n        if self.ref_artist.figure is None:\n            self.disconnect()\n            return False\n        else:\n            return True\n",
      "\n    def on_release(self, event):\n        if self._check_still_parented() and self.got_artist:\n            self.finalize_offset()\n            self.got_artist = False\n            self.canvas.mpl_disconnect(self._c1)\n\n            if self._use_blit:\n                self.ref_artist.set_animated(False)\n\n    def _check_still_parented(self):\n        if self.ref_artist.figure is None:\n            self.disconnect()\n            return False\n        else:\n            return True\n",
      "\n    def on_release(self, event):\n        if self._check_still_parented() and self.got_artist:\n            self.finalize_offset()\n            self.got_artist = False\n            self.canvas.mpl_disconnect(self._c1)\n\n            if self._use_blit:\n                self.ref_artist.set_animated(False)\n\n    def _check_still_parented(self):\n        if self.ref_artist.figure is None:\n            self.disconnect()\n            return False\n        else:\n            return True\n",
      "\n    def on_release(self, event):\n        if self._check_still_parented() and self.got_artist:\n            self.finalize_offset()\n            self.got_artist = False\n            self.canvas.mpl_disconnect(self._c1)\n\n            if self._use_blit:\n                self.ref_artist.set_animated(False)\n\n    def _check_still_parented(self):\n        if self.ref_artist.figure is None:\n            self.disconnect()\n            return False\n        else:\n            return True\n",
      "\n    def on_release(self, event):\n        if self._check_still_parented() and self.got_artist:\n            self.finalize_offset()\n            self.got_artist = False\n            self.canvas.mpl_disconnect(self._c1)\n\n            if self._use_blit:\n                self.ref_artist.set_animated(False)\n\n    def _check_still_parented(self):\n        if self.ref_artist.figure is None:\n            self.disconnect()\n            return False\n        else:\n            return True\n",
      "\n    def on_release(self, event):\n        if self._check_still_parented() and self.got_artist:\n            self.finalize_offset()\n            self.got_artist = False\n            self.canvas.mpl_disconnect(self._c1)\n\n            if self._use_blit:\n                self.ref_artist.set_animated(False)\n\n    def _check_still_parented(self):\n        if self.ref_artist.figure is None:\n            self.disconnect()\n            return False\n        else:\n            return True\n"
    ]
  },
  "combined_diffs": {
    "raw_patch": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 77768e7383..6ac07b6170 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1508,7 +1508,8 @@ class DraggableBase:\n         ]\n \n     # A property, not an attribute, to maintain picklability.\n-    canvas = property(lambda self: self.ref_artist.figure.canvas)\n+\n+    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n \n     def on_motion(self, evt):\n         if self._check_still_parented() and self.got_artist:\n@@ -1546,6 +1547,7 @@ class DraggableBase:\n             self.got_artist = False\n             self.canvas.mpl_disconnect(self._c1)\n \n+\n             if self._use_blit:\n                 self.ref_artist.set_animated(False)\n \n@@ -1556,17 +1558,19 @@ class DraggableBase:\n         else:\n             return True\n \n+\n     def disconnect(self):\n         \"\"\"Disconnect the callbacks.\"\"\"\n-        for cid in self.cids:\n-            self.canvas.mpl_disconnect(cid)\n-        try:\n-            c1 = self._c1\n-        except AttributeError:\n-            pass\n-        else:\n-            self.canvas.mpl_disconnect(c1)\n-\n+        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n+        if canvas is not None:\n+            for cid in self.cids:\n+                canvas.mpl_disconnect(cid)\n+            try:\n+                c1 = self._c1\n+            except AttributeError:\n+                pass\n+            else:\n+                canvas.mpl_disconnect(c1)\n     def save_offset(self):\n         pass\n \n",
    "variant_0": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 77768e7383..1a547dcca4 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1508,7 +1508,9 @@ class DraggableBase:\n         ]\n \n     # A property, not an attribute, to maintain picklability.\n-    canvas = property(lambda self: self.ref_artist.figure.canvas)\n+\n+    # A property, not an attribute, to maintain picklability.\n+    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n \n     def on_motion(self, evt):\n         if self._check_still_parented() and self.got_artist:\n@@ -1540,6 +1542,13 @@ class DraggableBase:\n                 \"motion_notify_event\", self.on_motion)\n             self.save_offset()\n \n+    def on_release(self, event):\n+        if self._check_still_parented() and self.got_artist:\n+            self.finalize_offset()\n+            self.got_artist = False\n+            self.canvas.mpl_disconnect(self._c1)\n+\n+\n     def on_release(self, event):\n         if self._check_still_parented() and self.got_artist:\n             self.finalize_offset()\n@@ -1555,18 +1564,21 @@ class DraggableBase:\n             return False\n         else:\n             return True\n+            return True\n+\n \n-    def disconnect(self):\n-        \"\"\"Disconnect the callbacks.\"\"\"\n+def disconnect(self):\n+    \"\"\"Disconnect the callbacks.\"\"\"\n+    canvas = self.canvas  # Get canvas once to avoid multiple property calls\n+    if canvas is not None:\n         for cid in self.cids:\n-            self.canvas.mpl_disconnect(cid)\n+            canvas.mpl_disconnect(cid)\n         try:\n             c1 = self._c1\n         except AttributeError:\n             pass\n         else:\n-            self.canvas.mpl_disconnect(c1)\n-\n+            canvas.mpl_disconnect(c1)\n     def save_offset(self):\n         pass\n \n",
    "variant_1": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 77768e7383..1a547dcca4 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1508,7 +1508,9 @@ class DraggableBase:\n         ]\n \n     # A property, not an attribute, to maintain picklability.\n-    canvas = property(lambda self: self.ref_artist.figure.canvas)\n+\n+    # A property, not an attribute, to maintain picklability.\n+    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n \n     def on_motion(self, evt):\n         if self._check_still_parented() and self.got_artist:\n@@ -1540,6 +1542,13 @@ class DraggableBase:\n                 \"motion_notify_event\", self.on_motion)\n             self.save_offset()\n \n+    def on_release(self, event):\n+        if self._check_still_parented() and self.got_artist:\n+            self.finalize_offset()\n+            self.got_artist = False\n+            self.canvas.mpl_disconnect(self._c1)\n+\n+\n     def on_release(self, event):\n         if self._check_still_parented() and self.got_artist:\n             self.finalize_offset()\n@@ -1555,18 +1564,21 @@ class DraggableBase:\n             return False\n         else:\n             return True\n+            return True\n+\n \n-    def disconnect(self):\n-        \"\"\"Disconnect the callbacks.\"\"\"\n+def disconnect(self):\n+    \"\"\"Disconnect the callbacks.\"\"\"\n+    canvas = self.canvas  # Get canvas once to avoid multiple property calls\n+    if canvas is not None:\n         for cid in self.cids:\n-            self.canvas.mpl_disconnect(cid)\n+            canvas.mpl_disconnect(cid)\n         try:\n             c1 = self._c1\n         except AttributeError:\n             pass\n         else:\n-            self.canvas.mpl_disconnect(c1)\n-\n+            canvas.mpl_disconnect(c1)\n     def save_offset(self):\n         pass\n \n",
    "variant_2": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 77768e7383..1a547dcca4 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1508,7 +1508,9 @@ class DraggableBase:\n         ]\n \n     # A property, not an attribute, to maintain picklability.\n-    canvas = property(lambda self: self.ref_artist.figure.canvas)\n+\n+    # A property, not an attribute, to maintain picklability.\n+    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n \n     def on_motion(self, evt):\n         if self._check_still_parented() and self.got_artist:\n@@ -1540,6 +1542,13 @@ class DraggableBase:\n                 \"motion_notify_event\", self.on_motion)\n             self.save_offset()\n \n+    def on_release(self, event):\n+        if self._check_still_parented() and self.got_artist:\n+            self.finalize_offset()\n+            self.got_artist = False\n+            self.canvas.mpl_disconnect(self._c1)\n+\n+\n     def on_release(self, event):\n         if self._check_still_parented() and self.got_artist:\n             self.finalize_offset()\n@@ -1555,18 +1564,21 @@ class DraggableBase:\n             return False\n         else:\n             return True\n+            return True\n+\n \n-    def disconnect(self):\n-        \"\"\"Disconnect the callbacks.\"\"\"\n+def disconnect(self):\n+    \"\"\"Disconnect the callbacks.\"\"\"\n+    canvas = self.canvas  # Get canvas once to avoid multiple property calls\n+    if canvas is not None:\n         for cid in self.cids:\n-            self.canvas.mpl_disconnect(cid)\n+            canvas.mpl_disconnect(cid)\n         try:\n             c1 = self._c1\n         except AttributeError:\n             pass\n         else:\n-            self.canvas.mpl_disconnect(c1)\n-\n+            canvas.mpl_disconnect(c1)\n     def save_offset(self):\n         pass\n \n",
    "variant_3": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 77768e7383..7e5662c05f 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1508,7 +1508,9 @@ class DraggableBase:\n         ]\n \n     # A property, not an attribute, to maintain picklability.\n-    canvas = property(lambda self: self.ref_artist.figure.canvas)\n+\n+    # A property, not an attribute, to maintain picklability.\n+    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n \n     def on_motion(self, evt):\n         if self._check_still_parented() and self.got_artist:\n@@ -1540,6 +1542,13 @@ class DraggableBase:\n                 \"motion_notify_event\", self.on_motion)\n             self.save_offset()\n \n+    def on_release(self, event):\n+        if self._check_still_parented() and self.got_artist:\n+            self.finalize_offset()\n+            self.got_artist = False\n+            self.canvas.mpl_disconnect(self._c1)\n+\n+\n     def on_release(self, event):\n         if self._check_still_parented() and self.got_artist:\n             self.finalize_offset()\n@@ -1555,18 +1564,21 @@ class DraggableBase:\n             return False\n         else:\n             return True\n+            return True\n+\n \n     def disconnect(self):\n         \"\"\"Disconnect the callbacks.\"\"\"\n-        for cid in self.cids:\n-            self.canvas.mpl_disconnect(cid)\n-        try:\n-            c1 = self._c1\n-        except AttributeError:\n-            pass\n-        else:\n-            self.canvas.mpl_disconnect(c1)\n-\n+        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n+        if canvas is not None:\n+            for cid in self.cids:\n+                canvas.mpl_disconnect(cid)\n+            try:\n+                c1 = self._c1\n+            except AttributeError:\n+                pass\n+            else:\n+                canvas.mpl_disconnect(c1)\n     def save_offset(self):\n         pass\n \n",
    "variant_4": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 77768e7383..7e5662c05f 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1508,7 +1508,9 @@ class DraggableBase:\n         ]\n \n     # A property, not an attribute, to maintain picklability.\n-    canvas = property(lambda self: self.ref_artist.figure.canvas)\n+\n+    # A property, not an attribute, to maintain picklability.\n+    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n \n     def on_motion(self, evt):\n         if self._check_still_parented() and self.got_artist:\n@@ -1540,6 +1542,13 @@ class DraggableBase:\n                 \"motion_notify_event\", self.on_motion)\n             self.save_offset()\n \n+    def on_release(self, event):\n+        if self._check_still_parented() and self.got_artist:\n+            self.finalize_offset()\n+            self.got_artist = False\n+            self.canvas.mpl_disconnect(self._c1)\n+\n+\n     def on_release(self, event):\n         if self._check_still_parented() and self.got_artist:\n             self.finalize_offset()\n@@ -1555,18 +1564,21 @@ class DraggableBase:\n             return False\n         else:\n             return True\n+            return True\n+\n \n     def disconnect(self):\n         \"\"\"Disconnect the callbacks.\"\"\"\n-        for cid in self.cids:\n-            self.canvas.mpl_disconnect(cid)\n-        try:\n-            c1 = self._c1\n-        except AttributeError:\n-            pass\n-        else:\n-            self.canvas.mpl_disconnect(c1)\n-\n+        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n+        if canvas is not None:\n+            for cid in self.cids:\n+                canvas.mpl_disconnect(cid)\n+            try:\n+                c1 = self._c1\n+            except AttributeError:\n+                pass\n+            else:\n+                canvas.mpl_disconnect(c1)\n     def save_offset(self):\n         pass\n \n",
    "variant_5": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 77768e7383..7e5662c05f 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1508,7 +1508,9 @@ class DraggableBase:\n         ]\n \n     # A property, not an attribute, to maintain picklability.\n-    canvas = property(lambda self: self.ref_artist.figure.canvas)\n+\n+    # A property, not an attribute, to maintain picklability.\n+    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n \n     def on_motion(self, evt):\n         if self._check_still_parented() and self.got_artist:\n@@ -1540,6 +1542,13 @@ class DraggableBase:\n                 \"motion_notify_event\", self.on_motion)\n             self.save_offset()\n \n+    def on_release(self, event):\n+        if self._check_still_parented() and self.got_artist:\n+            self.finalize_offset()\n+            self.got_artist = False\n+            self.canvas.mpl_disconnect(self._c1)\n+\n+\n     def on_release(self, event):\n         if self._check_still_parented() and self.got_artist:\n             self.finalize_offset()\n@@ -1555,18 +1564,21 @@ class DraggableBase:\n             return False\n         else:\n             return True\n+            return True\n+\n \n     def disconnect(self):\n         \"\"\"Disconnect the callbacks.\"\"\"\n-        for cid in self.cids:\n-            self.canvas.mpl_disconnect(cid)\n-        try:\n-            c1 = self._c1\n-        except AttributeError:\n-            pass\n-        else:\n-            self.canvas.mpl_disconnect(c1)\n-\n+        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n+        if canvas is not None:\n+            for cid in self.cids:\n+                canvas.mpl_disconnect(cid)\n+            try:\n+                c1 = self._c1\n+            except AttributeError:\n+                pass\n+            else:\n+                canvas.mpl_disconnect(c1)\n     def save_offset(self):\n         pass\n \n",
    "variant_6": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 77768e7383..7e5662c05f 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1508,7 +1508,9 @@ class DraggableBase:\n         ]\n \n     # A property, not an attribute, to maintain picklability.\n-    canvas = property(lambda self: self.ref_artist.figure.canvas)\n+\n+    # A property, not an attribute, to maintain picklability.\n+    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n \n     def on_motion(self, evt):\n         if self._check_still_parented() and self.got_artist:\n@@ -1540,6 +1542,13 @@ class DraggableBase:\n                 \"motion_notify_event\", self.on_motion)\n             self.save_offset()\n \n+    def on_release(self, event):\n+        if self._check_still_parented() and self.got_artist:\n+            self.finalize_offset()\n+            self.got_artist = False\n+            self.canvas.mpl_disconnect(self._c1)\n+\n+\n     def on_release(self, event):\n         if self._check_still_parented() and self.got_artist:\n             self.finalize_offset()\n@@ -1555,18 +1564,21 @@ class DraggableBase:\n             return False\n         else:\n             return True\n+            return True\n+\n \n     def disconnect(self):\n         \"\"\"Disconnect the callbacks.\"\"\"\n-        for cid in self.cids:\n-            self.canvas.mpl_disconnect(cid)\n-        try:\n-            c1 = self._c1\n-        except AttributeError:\n-            pass\n-        else:\n-            self.canvas.mpl_disconnect(c1)\n-\n+        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n+        if canvas is not None:\n+            for cid in self.cids:\n+                canvas.mpl_disconnect(cid)\n+            try:\n+                c1 = self._c1\n+            except AttributeError:\n+                pass\n+            else:\n+                canvas.mpl_disconnect(c1)\n     def save_offset(self):\n         pass\n \n",
    "variant_7": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 77768e7383..7e5662c05f 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1508,7 +1508,9 @@ class DraggableBase:\n         ]\n \n     # A property, not an attribute, to maintain picklability.\n-    canvas = property(lambda self: self.ref_artist.figure.canvas)\n+\n+    # A property, not an attribute, to maintain picklability.\n+    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n \n     def on_motion(self, evt):\n         if self._check_still_parented() and self.got_artist:\n@@ -1540,6 +1542,13 @@ class DraggableBase:\n                 \"motion_notify_event\", self.on_motion)\n             self.save_offset()\n \n+    def on_release(self, event):\n+        if self._check_still_parented() and self.got_artist:\n+            self.finalize_offset()\n+            self.got_artist = False\n+            self.canvas.mpl_disconnect(self._c1)\n+\n+\n     def on_release(self, event):\n         if self._check_still_parented() and self.got_artist:\n             self.finalize_offset()\n@@ -1555,18 +1564,21 @@ class DraggableBase:\n             return False\n         else:\n             return True\n+            return True\n+\n \n     def disconnect(self):\n         \"\"\"Disconnect the callbacks.\"\"\"\n-        for cid in self.cids:\n-            self.canvas.mpl_disconnect(cid)\n-        try:\n-            c1 = self._c1\n-        except AttributeError:\n-            pass\n-        else:\n-            self.canvas.mpl_disconnect(c1)\n-\n+        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n+        if canvas is not None:\n+            for cid in self.cids:\n+                canvas.mpl_disconnect(cid)\n+            try:\n+                c1 = self._c1\n+            except AttributeError:\n+                pass\n+            else:\n+                canvas.mpl_disconnect(c1)\n     def save_offset(self):\n         pass\n \n",
    "variant_8": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 77768e7383..7e5662c05f 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1508,7 +1508,9 @@ class DraggableBase:\n         ]\n \n     # A property, not an attribute, to maintain picklability.\n-    canvas = property(lambda self: self.ref_artist.figure.canvas)\n+\n+    # A property, not an attribute, to maintain picklability.\n+    canvas = property(lambda self: self.ref_artist.figure.canvas if self.ref_artist.figure is not None else None)\n \n     def on_motion(self, evt):\n         if self._check_still_parented() and self.got_artist:\n@@ -1540,6 +1542,13 @@ class DraggableBase:\n                 \"motion_notify_event\", self.on_motion)\n             self.save_offset()\n \n+    def on_release(self, event):\n+        if self._check_still_parented() and self.got_artist:\n+            self.finalize_offset()\n+            self.got_artist = False\n+            self.canvas.mpl_disconnect(self._c1)\n+\n+\n     def on_release(self, event):\n         if self._check_still_parented() and self.got_artist:\n             self.finalize_offset()\n@@ -1555,18 +1564,21 @@ class DraggableBase:\n             return False\n         else:\n             return True\n+            return True\n+\n \n     def disconnect(self):\n         \"\"\"Disconnect the callbacks.\"\"\"\n-        for cid in self.cids:\n-            self.canvas.mpl_disconnect(cid)\n-        try:\n-            c1 = self._c1\n-        except AttributeError:\n-            pass\n-        else:\n-            self.canvas.mpl_disconnect(c1)\n-\n+        canvas = self.canvas  # Get canvas once to avoid multiple property calls\n+        if canvas is not None:\n+            for cid in self.cids:\n+                canvas.mpl_disconnect(cid)\n+            try:\n+                c1 = self._c1\n+            except AttributeError:\n+                pass\n+            else:\n+                canvas.mpl_disconnect(c1)\n     def save_offset(self):\n         pass\n \n"
  }
}