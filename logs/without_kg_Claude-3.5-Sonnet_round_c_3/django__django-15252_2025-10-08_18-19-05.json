{
  "zero_patches": {
    "Location 1 (/root/hy/projects_3/django/django/db/migrations/recorder.py lines 59-70)": "\n    def ensure_schema(self):\n        \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n        from django.db import router\n        \n        # Check if migrations are allowed on this database\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n            \n        # If the table's there, that's fine - we've never changed its schema\n        # in the codebase.\n        if self.has_table():\n            return\n        # Make the table\n        try:\n            with self.connection.schema_editor() as editor:\n                editor.create_model(self.Migration)\n        except DatabaseError as exc:\n            raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n",
    "Location 2 (/root/hy/projects_3/django/django/db/migrations/recorder.py lines 84-87)": "\ndef record_applied(self, app, name):\n    \"\"\"Record that a migration was applied.\"\"\"\n    from django.db import router\n    if not router.allow_migrate(self.connection.alias, 'migrations'):\n        return\n    self.ensure_schema()\n    self.migration_qs.create(app=app, name=name)\n",
    "Location 3 (/root/hy/projects_3/django/django/db/migrations/recorder.py lines 89-92)": "\n    def record_unapplied(self, app, name):\n        \"\"\"Record that a migration was unapplied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.filter(app=app, name=name).delete()\n",
    "Location 4 (/root/hy/projects_3/django/django/db/migrations/recorder.py lines 72-82)": "\n    def applied_migrations(self):\n        \"\"\"\n        Return a dict mapping (app_name, migration_name) to Migration instances\n        for all applied migrations.\n        \"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return {}\n        if self.has_table():\n            return {(migration.app, migration.name): migration for migration in self.migration_qs}\n        else:\n            # If the django_migrations table doesn't exist, then no migrations\n            # are applied.\n            return {}\n"
  },
  "variant_patches": {
    "Location 1 (/root/hy/projects_3/django/django/db/migrations/recorder.py lines 59-70)": [
      "\n    def ensure_schema(self):\n        \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n        from django.db import router\n        \n        # Check if migrations are allowed on this database\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        \n        # If the table's there, that's fine - we've never changed its schema\n        # in the codebase.\n        if self.has_table():\n            return\n        # Make the table\n        try:\n            with self.connection.schema_editor() as editor:\n                editor.create_model(self.Migration)\n        except DatabaseError as exc:\n            raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n",
      "\n    def ensure_schema(self):\n        \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n        from django.db import router\n        \n        # Check if migrations are allowed on this database\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n            \n        # If the table's there, that's fine - we've never changed its schema\n        # in the codebase.\n        if self.has_table():\n            return\n        # Make the table\n        try:\n            with self.connection.schema_editor() as editor:\n                editor.create_model(self.Migration)\n        except DatabaseError as exc:\n            raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n",
      "\n    def ensure_schema(self):\n        \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n        from django.db import router\n        \n        # Check if migrations are allowed on this database\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n            \n        # If the table's there, that's fine - we've never changed its schema\n        # in the codebase.\n        if self.has_table():\n            return\n        # Make the table\n        try:\n            with self.connection.schema_editor() as editor:\n                editor.create_model(self.Migration)\n        except DatabaseError as exc:\n            raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n",
      "\n    def ensure_schema(self):\n        \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n        # Check if migrations are allowed on this database\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        # If the table's there, that's fine - we've never changed its schema\n        # in the codebase.\n        if self.has_table():\n            return\n        # Make the table\n        try:\n            with self.connection.schema_editor() as editor:\n                editor.create_model(self.Migration)\n        except DatabaseError as exc:\n            raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n",
      "\n    def ensure_schema(self):\n        \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n        from django.db import router\n        \n        # Check if migrations are allowed on this database\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n            \n        # If the table's there, that's fine - we've never changed its schema\n        # in the codebase.\n        if self.has_table():\n            return\n        # Make the table\n        try:\n            with self.connection.schema_editor() as editor:\n                editor.create_model(self.Migration)\n        except DatabaseError as exc:\n            raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n",
      "\n    def ensure_schema(self):\n        \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n        from django.db import router\n        \n        # Check if migrations are allowed on this database\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n            \n        # If the table's there, that's fine - we've never changed its schema\n        # in the codebase.\n        if self.has_table():\n            return\n        # Make the table\n        try:\n            with self.connection.schema_editor() as editor:\n                editor.create_model(self.Migration)\n        except DatabaseError as exc:\n            raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n",
      "\n    def ensure_schema(self):\n        \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n        from django.db import router\n        \n        # Check if migrations are allowed on this database\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        \n        # If the table's there, that's fine - we've never changed its schema\n        # in the codebase.\n        if self.has_table():\n            return\n        # Make the table\n        try:\n            with self.connection.schema_editor() as editor:\n                editor.create_model(self.Migration)\n        except DatabaseError as exc:\n            raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n",
      "\n    def ensure_schema(self):\n        \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n        from django.db import router\n        \n        # Check if migrations are allowed on this database\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n            \n        # If the table's there, that's fine - we've never changed its schema\n        # in the codebase.\n        if self.has_table():\n            return\n        # Make the table\n        try:\n            with self.connection.schema_editor() as editor:\n                editor.create_model(self.Migration)\n        except DatabaseError as exc:\n            raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n"
    ],
    "Location 2 (/root/hy/projects_3/django/django/db/migrations/recorder.py lines 84-87)": [
      "\n    def record_applied(self, app, name):\n        \"\"\"Record that a migration was applied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.create(app=app, name=name)\n",
      "\ndef record_applied(self, app, name):\n    \"\"\"Record that a migration was applied.\"\"\"\n    from django.db import router\n    if not router.allow_migrate(self.connection.alias, 'migrations'):\n        return\n    self.ensure_schema()\n    self.migration_qs.create(app=app, name=name)\n",
      "\n    def record_applied(self, app, name):\n        \"\"\"Record that a migration was applied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.create(app=app, name=name)\n",
      "\n    def record_applied(self, app, name):\n        \"\"\"Record that a migration was applied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.create(app=app, name=name)\n",
      "\n    def record_applied(self, app, name):\n        \"\"\"Record that a migration was applied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.create(app=app, name=name)\n",
      "\ndef record_applied(self, app, name):\n    \"\"\"Record that a migration was applied.\"\"\"\n    from django.db import router\n    if not router.allow_migrate(self.connection.alias, 'migrations'):\n        return\n    self.ensure_schema()\n    self.migration_qs.create(app=app, name=name)\n",
      "\n    def record_applied(self, app, name):\n        \"\"\"Record that a migration was applied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.create(app=app, name=name)\n",
      "\ndef record_applied(self, app, name):\n    \"\"\"Record that a migration was applied.\"\"\"\n    from django.db import router\n    if not router.allow_migrate(self.connection.alias, 'migrations'):\n        return\n    self.ensure_schema()\n    self.migration_qs.create(app=app, name=name)\n"
    ],
    "Location 3 (/root/hy/projects_3/django/django/db/migrations/recorder.py lines 89-92)": [
      "\n    def record_unapplied(self, app, name):\n        \"\"\"Record that a migration was unapplied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.filter(app=app, name=name).delete()\n",
      "\n    def record_unapplied(self, app, name):\n        \"\"\"Record that a migration was unapplied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.filter(app=app, name=name).delete()\n",
      "\n    def record_unapplied(self, app, name):\n        \"\"\"Record that a migration was unapplied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.filter(app=app, name=name).delete()\n",
      "\n    def record_unapplied(self, app, name):\n        \"\"\"Record that a migration was unapplied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.filter(app=app, name=name).delete()\n",
      "\ndef record_unapplied(self, app, name):\n    \"\"\"Record that a migration was unapplied.\"\"\"\n    from django.db import router\n    if not router.allow_migrate(self.connection.alias, 'migrations'):\n        return\n    self.ensure_schema()\n    self.migration_qs.filter(app=app, name=name).delete()\n",
      "\n    def record_unapplied(self, app, name):\n        \"\"\"Record that a migration was unapplied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.filter(app=app, name=name).delete()\n",
      "\n    def record_unapplied(self, app, name):\n        \"\"\"Record that a migration was unapplied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.filter(app=app, name=name).delete()\n",
      "\n    def record_unapplied(self, app, name):\n        \"\"\"Record that a migration was unapplied.\"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return\n        self.ensure_schema()\n        self.migration_qs.filter(app=app, name=name).delete()\n"
    ],
    "Location 4 (/root/hy/projects_3/django/django/db/migrations/recorder.py lines 72-82)": [
      "\n    def applied_migrations(self):\n        \"\"\"\n        Return a dict mapping (app_name, migration_name) to Migration instances\n        for all applied migrations.\n        \"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return {}\n        if self.has_table():\n            return {(migration.app, migration.name): migration for migration in self.migration_qs}\n        else:\n            # If the django_migrations table doesn't exist, then no migrations\n            # are applied.\n            return {}\n",
      "\n    def applied_migrations(self):\n        \"\"\"\n        Return a dict mapping (app_name, migration_name) to Migration instances\n        for all applied migrations.\n        \"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return {}\n        if self.has_table():\n            return {(migration.app, migration.name): migration for migration in self.migration_qs}\n        else:\n            # If the django_migrations table doesn't exist, then no migrations\n            # are applied.\n            return {}\n",
      "\n    def applied_migrations(self):\n        \"\"\"\n        Return a dict mapping (app_name, migration_name) to Migration instances\n        for all applied migrations.\n        \"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return {}\n        if self.has_table():\n            return {(migration.app, migration.name): migration for migration in self.migration_qs}\n        else:\n            # If the django_migrations table doesn't exist, then no migrations\n            # are applied.\n            return {}\n",
      "\n    def applied_migrations(self):\n        \"\"\"\n        Return a dict mapping (app_name, migration_name) to Migration instances\n        for all applied migrations.\n        \"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return {}\n        if self.has_table():\n            return {(migration.app, migration.name): migration for migration in self.migration_qs}\n        else:\n            # If the django_migrations table doesn't exist, then no migrations\n            # are applied.\n            return {}\n",
      "\n    def applied_migrations(self):\n        \"\"\"\n        Return a dict mapping (app_name, migration_name) to Migration instances\n        for all applied migrations.\n        \"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return {}\n        if self.has_table():\n            return {(migration.app, migration.name): migration for migration in self.migration_qs}\n        else:\n            # If the django_migrations table doesn't exist, then no migrations\n            # are applied.\n            return {}\n",
      "\ndef applied_migrations(self):\n    \"\"\"\n    Return a dict mapping (app_name, migration_name) to Migration instances\n    for all applied migrations.\n    \"\"\"\n    from django.db import router\n    if not router.allow_migrate(self.connection.alias, 'migrations'):\n        return {}\n    if self.has_table():\n        return {(migration.app, migration.name): migration for migration in self.migration_qs}\n    else:\n        # If the django_migrations table doesn't exist, then no migrations\n        # are applied.\n        return {}\n",
      "\n    def applied_migrations(self):\n        \"\"\"\n        Return a dict mapping (app_name, migration_name) to Migration instances\n        for all applied migrations.\n        \"\"\"\n        from django.db import router\n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return {}\n        if self.has_table():\n            return {(migration.app, migration.name): migration for migration in self.migration_qs}\n        else:\n            # If the django_migrations table doesn't exist, then no migrations\n            # are applied.\n            return {}\n",
      "\n    def applied_migrations(self):\n        \"\"\"\n        Return a dict mapping (app_name, migration_name) to Migration instances\n        for all applied migrations.\n        \"\"\"\n        from django.db import router\n        \n        if not router.allow_migrate(self.connection.alias, 'migrations'):\n            return {}\n        \n        if self.has_table():\n            return {(migration.app, migration.name): migration for migration in self.migration_qs}\n        else:\n            # If the django_migrations table doesn't exist, then no migrations\n            # are applied.\n            return {}\n"
    ]
  },
  "combined_diffs": {
    "raw_patch": "diff --git a/django/db/migrations/recorder.py b/django/db/migrations/recorder.py\nindex 1a37c6b7d0..2a28ba9006 100644\n--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -56,8 +56,13 @@ class MigrationRecorder:\n             tables = self.connection.introspection.table_names(cursor)\n         return self.Migration._meta.db_table in tables\n \n+\n     def ensure_schema(self):\n         \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n+        from django.db import router\n+        # Check if migrations are allowed on this database\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         # If the table's there, that's fine - we've never changed its schema\n         # in the codebase.\n         if self.has_table():\n@@ -69,11 +74,15 @@ class MigrationRecorder:\n         except DatabaseError as exc:\n             raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n \n+\n     def applied_migrations(self):\n         \"\"\"\n         Return a dict mapping (app_name, migration_name) to Migration instances\n         for all applied migrations.\n         \"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return {}\n         if self.has_table():\n             return {(migration.app, migration.name): migration for migration in self.migration_qs}\n         else:\n@@ -81,13 +90,21 @@ class MigrationRecorder:\n             # are applied.\n             return {}\n \n+\n     def record_applied(self, app, name):\n         \"\"\"Record that a migration was applied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.create(app=app, name=name)\n \n+\n     def record_unapplied(self, app, name):\n         \"\"\"Record that a migration was unapplied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.filter(app=app, name=name).delete()\n \n",
    "variant_0": "diff --git a/django/db/migrations/recorder.py b/django/db/migrations/recorder.py\nindex 1a37c6b7d0..35161276c0 100644\n--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -56,8 +56,15 @@ class MigrationRecorder:\n             tables = self.connection.introspection.table_names(cursor)\n         return self.Migration._meta.db_table in tables\n \n+\n     def ensure_schema(self):\n         \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n+        from django.db import router\n+        \n+        # Check if migrations are allowed on this database\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n+            \n         # If the table's there, that's fine - we've never changed its schema\n         # in the codebase.\n         if self.has_table():\n@@ -69,11 +76,15 @@ class MigrationRecorder:\n         except DatabaseError as exc:\n             raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n \n+\n     def applied_migrations(self):\n         \"\"\"\n         Return a dict mapping (app_name, migration_name) to Migration instances\n         for all applied migrations.\n         \"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return {}\n         if self.has_table():\n             return {(migration.app, migration.name): migration for migration in self.migration_qs}\n         else:\n@@ -81,13 +92,21 @@ class MigrationRecorder:\n             # are applied.\n             return {}\n \n-    def record_applied(self, app, name):\n-        \"\"\"Record that a migration was applied.\"\"\"\n-        self.ensure_schema()\n-        self.migration_qs.create(app=app, name=name)\n+\n+def record_applied(self, app, name):\n+    \"\"\"Record that a migration was applied.\"\"\"\n+    from django.db import router\n+    if not router.allow_migrate(self.connection.alias, 'migrations'):\n+        return\n+    self.ensure_schema()\n+    self.migration_qs.create(app=app, name=name)\n+\n \n     def record_unapplied(self, app, name):\n         \"\"\"Record that a migration was unapplied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.filter(app=app, name=name).delete()\n \n",
    "variant_1": "diff --git a/django/db/migrations/recorder.py b/django/db/migrations/recorder.py\nindex 1a37c6b7d0..d432f3df1f 100644\n--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -56,8 +56,15 @@ class MigrationRecorder:\n             tables = self.connection.introspection.table_names(cursor)\n         return self.Migration._meta.db_table in tables\n \n+\n     def ensure_schema(self):\n         \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n+        from django.db import router\n+        \n+        # Check if migrations are allowed on this database\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n+        \n         # If the table's there, that's fine - we've never changed its schema\n         # in the codebase.\n         if self.has_table():\n@@ -69,11 +76,15 @@ class MigrationRecorder:\n         except DatabaseError as exc:\n             raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n \n+\n     def applied_migrations(self):\n         \"\"\"\n         Return a dict mapping (app_name, migration_name) to Migration instances\n         for all applied migrations.\n         \"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return {}\n         if self.has_table():\n             return {(migration.app, migration.name): migration for migration in self.migration_qs}\n         else:\n@@ -81,13 +92,21 @@ class MigrationRecorder:\n             # are applied.\n             return {}\n \n+\n     def record_applied(self, app, name):\n         \"\"\"Record that a migration was applied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.create(app=app, name=name)\n \n+\n     def record_unapplied(self, app, name):\n         \"\"\"Record that a migration was unapplied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.filter(app=app, name=name).delete()\n \n",
    "variant_2": "diff --git a/django/db/migrations/recorder.py b/django/db/migrations/recorder.py\nindex 1a37c6b7d0..35161276c0 100644\n--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -56,8 +56,15 @@ class MigrationRecorder:\n             tables = self.connection.introspection.table_names(cursor)\n         return self.Migration._meta.db_table in tables\n \n+\n     def ensure_schema(self):\n         \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n+        from django.db import router\n+        \n+        # Check if migrations are allowed on this database\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n+            \n         # If the table's there, that's fine - we've never changed its schema\n         # in the codebase.\n         if self.has_table():\n@@ -69,11 +76,15 @@ class MigrationRecorder:\n         except DatabaseError as exc:\n             raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n \n+\n     def applied_migrations(self):\n         \"\"\"\n         Return a dict mapping (app_name, migration_name) to Migration instances\n         for all applied migrations.\n         \"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return {}\n         if self.has_table():\n             return {(migration.app, migration.name): migration for migration in self.migration_qs}\n         else:\n@@ -81,13 +92,21 @@ class MigrationRecorder:\n             # are applied.\n             return {}\n \n-    def record_applied(self, app, name):\n-        \"\"\"Record that a migration was applied.\"\"\"\n-        self.ensure_schema()\n-        self.migration_qs.create(app=app, name=name)\n+\n+def record_applied(self, app, name):\n+    \"\"\"Record that a migration was applied.\"\"\"\n+    from django.db import router\n+    if not router.allow_migrate(self.connection.alias, 'migrations'):\n+        return\n+    self.ensure_schema()\n+    self.migration_qs.create(app=app, name=name)\n+\n \n     def record_unapplied(self, app, name):\n         \"\"\"Record that a migration was unapplied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.filter(app=app, name=name).delete()\n \n",
    "variant_3": "diff --git a/django/db/migrations/recorder.py b/django/db/migrations/recorder.py\nindex 1a37c6b7d0..6e0320248c 100644\n--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -56,8 +56,15 @@ class MigrationRecorder:\n             tables = self.connection.introspection.table_names(cursor)\n         return self.Migration._meta.db_table in tables\n \n+\n     def ensure_schema(self):\n         \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n+        from django.db import router\n+        \n+        # Check if migrations are allowed on this database\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n+            \n         # If the table's there, that's fine - we've never changed its schema\n         # in the codebase.\n         if self.has_table():\n@@ -69,11 +76,15 @@ class MigrationRecorder:\n         except DatabaseError as exc:\n             raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n \n+\n     def applied_migrations(self):\n         \"\"\"\n         Return a dict mapping (app_name, migration_name) to Migration instances\n         for all applied migrations.\n         \"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return {}\n         if self.has_table():\n             return {(migration.app, migration.name): migration for migration in self.migration_qs}\n         else:\n@@ -81,13 +92,21 @@ class MigrationRecorder:\n             # are applied.\n             return {}\n \n+\n     def record_applied(self, app, name):\n         \"\"\"Record that a migration was applied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.create(app=app, name=name)\n \n+\n     def record_unapplied(self, app, name):\n         \"\"\"Record that a migration was unapplied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.filter(app=app, name=name).delete()\n \n",
    "variant_4": "diff --git a/django/db/migrations/recorder.py b/django/db/migrations/recorder.py\nindex 1a37c6b7d0..f2d3b1a9aa 100644\n--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -56,8 +56,13 @@ class MigrationRecorder:\n             tables = self.connection.introspection.table_names(cursor)\n         return self.Migration._meta.db_table in tables\n \n+\n     def ensure_schema(self):\n         \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n+        # Check if migrations are allowed on this database\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         # If the table's there, that's fine - we've never changed its schema\n         # in the codebase.\n         if self.has_table():\n@@ -69,11 +74,15 @@ class MigrationRecorder:\n         except DatabaseError as exc:\n             raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n \n+\n     def applied_migrations(self):\n         \"\"\"\n         Return a dict mapping (app_name, migration_name) to Migration instances\n         for all applied migrations.\n         \"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return {}\n         if self.has_table():\n             return {(migration.app, migration.name): migration for migration in self.migration_qs}\n         else:\n@@ -81,13 +90,21 @@ class MigrationRecorder:\n             # are applied.\n             return {}\n \n+\n     def record_applied(self, app, name):\n         \"\"\"Record that a migration was applied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.create(app=app, name=name)\n \n+\n     def record_unapplied(self, app, name):\n         \"\"\"Record that a migration was unapplied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.filter(app=app, name=name).delete()\n \n",
    "variant_5": "diff --git a/django/db/migrations/recorder.py b/django/db/migrations/recorder.py\nindex 1a37c6b7d0..469e00b7c0 100644\n--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -56,8 +56,15 @@ class MigrationRecorder:\n             tables = self.connection.introspection.table_names(cursor)\n         return self.Migration._meta.db_table in tables\n \n+\n     def ensure_schema(self):\n         \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n+        from django.db import router\n+        \n+        # Check if migrations are allowed on this database\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n+            \n         # If the table's there, that's fine - we've never changed its schema\n         # in the codebase.\n         if self.has_table():\n@@ -69,11 +76,15 @@ class MigrationRecorder:\n         except DatabaseError as exc:\n             raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n \n+\n     def applied_migrations(self):\n         \"\"\"\n         Return a dict mapping (app_name, migration_name) to Migration instances\n         for all applied migrations.\n         \"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return {}\n         if self.has_table():\n             return {(migration.app, migration.name): migration for migration in self.migration_qs}\n         else:\n@@ -81,15 +92,23 @@ class MigrationRecorder:\n             # are applied.\n             return {}\n \n+\n     def record_applied(self, app, name):\n         \"\"\"Record that a migration was applied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.create(app=app, name=name)\n \n-    def record_unapplied(self, app, name):\n-        \"\"\"Record that a migration was unapplied.\"\"\"\n-        self.ensure_schema()\n-        self.migration_qs.filter(app=app, name=name).delete()\n+\n+def record_unapplied(self, app, name):\n+    \"\"\"Record that a migration was unapplied.\"\"\"\n+    from django.db import router\n+    if not router.allow_migrate(self.connection.alias, 'migrations'):\n+        return\n+    self.ensure_schema()\n+    self.migration_qs.filter(app=app, name=name).delete()\n \n     def flush(self):\n         \"\"\"Delete all migration records. Useful for testing migrations.\"\"\"\n",
    "variant_6": "diff --git a/django/db/migrations/recorder.py b/django/db/migrations/recorder.py\nindex 1a37c6b7d0..f9117b7a3a 100644\n--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -56,8 +56,15 @@ class MigrationRecorder:\n             tables = self.connection.introspection.table_names(cursor)\n         return self.Migration._meta.db_table in tables\n \n+\n     def ensure_schema(self):\n         \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n+        from django.db import router\n+        \n+        # Check if migrations are allowed on this database\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n+            \n         # If the table's there, that's fine - we've never changed its schema\n         # in the codebase.\n         if self.has_table():\n@@ -69,25 +76,37 @@ class MigrationRecorder:\n         except DatabaseError as exc:\n             raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n \n-    def applied_migrations(self):\n-        \"\"\"\n-        Return a dict mapping (app_name, migration_name) to Migration instances\n-        for all applied migrations.\n-        \"\"\"\n-        if self.has_table():\n-            return {(migration.app, migration.name): migration for migration in self.migration_qs}\n-        else:\n-            # If the django_migrations table doesn't exist, then no migrations\n-            # are applied.\n-            return {}\n-\n-    def record_applied(self, app, name):\n-        \"\"\"Record that a migration was applied.\"\"\"\n-        self.ensure_schema()\n-        self.migration_qs.create(app=app, name=name)\n+\n+def applied_migrations(self):\n+    \"\"\"\n+    Return a dict mapping (app_name, migration_name) to Migration instances\n+    for all applied migrations.\n+    \"\"\"\n+    from django.db import router\n+    if not router.allow_migrate(self.connection.alias, 'migrations'):\n+        return {}\n+    if self.has_table():\n+        return {(migration.app, migration.name): migration for migration in self.migration_qs}\n+    else:\n+        # If the django_migrations table doesn't exist, then no migrations\n+        # are applied.\n+        return {}\n+\n+\n+def record_applied(self, app, name):\n+    \"\"\"Record that a migration was applied.\"\"\"\n+    from django.db import router\n+    if not router.allow_migrate(self.connection.alias, 'migrations'):\n+        return\n+    self.ensure_schema()\n+    self.migration_qs.create(app=app, name=name)\n+\n \n     def record_unapplied(self, app, name):\n         \"\"\"Record that a migration was unapplied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.filter(app=app, name=name).delete()\n \n",
    "variant_7": "diff --git a/django/db/migrations/recorder.py b/django/db/migrations/recorder.py\nindex 1a37c6b7d0..d432f3df1f 100644\n--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -56,8 +56,15 @@ class MigrationRecorder:\n             tables = self.connection.introspection.table_names(cursor)\n         return self.Migration._meta.db_table in tables\n \n+\n     def ensure_schema(self):\n         \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n+        from django.db import router\n+        \n+        # Check if migrations are allowed on this database\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n+        \n         # If the table's there, that's fine - we've never changed its schema\n         # in the codebase.\n         if self.has_table():\n@@ -69,11 +76,15 @@ class MigrationRecorder:\n         except DatabaseError as exc:\n             raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n \n+\n     def applied_migrations(self):\n         \"\"\"\n         Return a dict mapping (app_name, migration_name) to Migration instances\n         for all applied migrations.\n         \"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return {}\n         if self.has_table():\n             return {(migration.app, migration.name): migration for migration in self.migration_qs}\n         else:\n@@ -81,13 +92,21 @@ class MigrationRecorder:\n             # are applied.\n             return {}\n \n+\n     def record_applied(self, app, name):\n         \"\"\"Record that a migration was applied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.create(app=app, name=name)\n \n+\n     def record_unapplied(self, app, name):\n         \"\"\"Record that a migration was unapplied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.filter(app=app, name=name).delete()\n \n",
    "variant_8": "diff --git a/django/db/migrations/recorder.py b/django/db/migrations/recorder.py\nindex 1a37c6b7d0..87896323d2 100644\n--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -56,8 +56,15 @@ class MigrationRecorder:\n             tables = self.connection.introspection.table_names(cursor)\n         return self.Migration._meta.db_table in tables\n \n+\n     def ensure_schema(self):\n         \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n+        from django.db import router\n+        \n+        # Check if migrations are allowed on this database\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n+            \n         # If the table's there, that's fine - we've never changed its schema\n         # in the codebase.\n         if self.has_table():\n@@ -69,11 +76,17 @@ class MigrationRecorder:\n         except DatabaseError as exc:\n             raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n \n+\n     def applied_migrations(self):\n         \"\"\"\n         Return a dict mapping (app_name, migration_name) to Migration instances\n         for all applied migrations.\n         \"\"\"\n+        from django.db import router\n+        \n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return {}\n+        \n         if self.has_table():\n             return {(migration.app, migration.name): migration for migration in self.migration_qs}\n         else:\n@@ -81,13 +94,21 @@ class MigrationRecorder:\n             # are applied.\n             return {}\n \n-    def record_applied(self, app, name):\n-        \"\"\"Record that a migration was applied.\"\"\"\n-        self.ensure_schema()\n-        self.migration_qs.create(app=app, name=name)\n+\n+def record_applied(self, app, name):\n+    \"\"\"Record that a migration was applied.\"\"\"\n+    from django.db import router\n+    if not router.allow_migrate(self.connection.alias, 'migrations'):\n+        return\n+    self.ensure_schema()\n+    self.migration_qs.create(app=app, name=name)\n+\n \n     def record_unapplied(self, app, name):\n         \"\"\"Record that a migration was unapplied.\"\"\"\n+        from django.db import router\n+        if not router.allow_migrate(self.connection.alias, 'migrations'):\n+            return\n         self.ensure_schema()\n         self.migration_qs.filter(app=app, name=name).delete()\n \n"
  }
}